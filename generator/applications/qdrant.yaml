name: qdrant
productName: Qdrant
appVersion: 1.4.1
description: is a <<vector similarity search engine and vector database>>
home: https://qdrant.tech/
icon: https://raw.githubusercontent.com/cowboysysop/charts/master/charts/qdrant/icon.png
license: 2023
source: https://github.com/qdrant/qdrant
version: 3.0.0
updates: |
  ### Upgrading to version 3.0.0

  The chart now uses forked versions of the Bitnami charts to reference the Bitnami Legacy repository:

  - https://github.com/bitnami/containers/issues/83267

  A label `app.kubernetes.io/component` will be added to the StatefulSet. Run this command before upgrading to prevent an immutable field error:

  ```bash
  $ kubectl delete statefulset/my-qdrant-statefulset
  ```

  Pod and container security contexts are now configured with default values.

  Information about services are no more injected into pod's environment variable.

  ### Upgrading to version 2.0.0

  The chart is now tested with Kubernetes >= 1.24 and Helm >= 3.9.

  Future upgrades may introduce undetected breaking changes if you continue to use older versions.
components:
  - name: qdrant
    configmap: |
      production.yaml: |
        service:
          http_port: {{ .Values.containerPorts.http }}
          grpc_port: {{ .Values.containerPorts.grpc }}
        cluster:
          enabled: true
          p2p:
            port: {{ .Values.containerPorts.p2p }}
        telemetry_disabled: true
    deployment:
      type: statefulset
      container:
        command: |
          - /bin/bash
          - -ec
          - |
            args="--uri http://${POD_NAME}.{{ include "qdrant.headless.fullname" . }}:{{ .Values.containerPorts.p2p }}/"
            if [ "${POD_NAME}" != "{{ include "qdrant.fullname" . }}-0" ]; then
                args="${args} --bootstrap http://{{ include "qdrant.fullname" . }}-0.{{ include "qdrant.headless.fullname" . }}:{{ .Values.containerPorts.p2p }}/"

                # With current tick period of 100ms, leader will be established in approximately 4000ms.
                # To avoid rejected operations - add peers and submit operations only after this period.
                sleep 4
            fi
            ./entrypoint.sh "${args}" "$@"
          - $@
        env: |
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
        livenessProbe:
          httpGet:
            path: /
        readinessProbe:
          httpGet:
            path: /
        securityContext:
          readOnlyRootFilesystem: false
          runAsUser: 0
          runAsGroup: 0
        startupProbe:
          httpGet:
            path: /
        volumeMounts: |
          - name: config
            mountPath: /qdrant/config/production.yaml
            subPath: production.yaml
          - name: data
            mountPath: /qdrant/storage
            subPath: storage
          - name: data
            mountPath: /qdrant/snapshots
            subPath: snapshots
    image:
      registry: docker.io
      repository: qdrant/qdrant
      tag: v1.4.1
    ingress:
      paths:
        - /
    persistentvolumeclaim: true
    service:
      ports:
        - name: http
          number: 6333
          description: HTTP
        - name: grpc
          number: 6334
          description: gRPC
    headless:
      ports:
        - name: p2p
          nameContainer: tcp-p2p
          nameService: tcp-p2p
          number: 6335
          description: P2P
tests: |
  import requests


  def test_service_connection():
      url = "http://{{ include "qdrant.fullname" . }}:{{ .Values.service.ports.http }}/"

      response = requests.get(url)

      assert response.status_code == 200
