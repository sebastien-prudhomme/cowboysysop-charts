name: kroki
productName: Kroki
appVersion: 0.28.0
description: <<creates diagrams from textual descriptions>>
home: https://kroki.io/
icon: https://raw.githubusercontent.com/yuzutech/kroki.io/master/assets/favicon-196x196.png
license: 2021
source: https://github.com/yuzutech/kroki
version: 6.0.0
updates: |
  ### Upgrading to version 6.0.0

  The chart now uses forked versions of the Bitnami charts to reference the Bitnami Legacy repository:

  - https://github.com/bitnami/containers/issues/83267

  A label `app.kubernetes.io/component` will be added to the Deployment. Run this command before upgrading to prevent an immutable field error:

  ```bash
  $ kubectl delete deployment/my-kroki-deployment
  ```

  Pod and container security contexts are now configured with default values.

  Information about services are no more injected into pod's environment variable.

  ### Upgrading to version 5.0.0

  BlockDiag and WireViz are now available in the main Kroki container.

  All parameters related to BlockDiag and WireViz have been removed.

  ### Upgrading to version 4.0.0

  The chart is now tested with Kubernetes >= 1.24 and Helm >= 3.9.

  Future upgrades may introduce undetected breaking changes if you continue to use older versions.

  ### Upgrading to version 3.0.0

  Some parameters related to port management have been modified:

  - Parameter `service.port` has been renamed `service.ports.http`.
  - Parameter `service.nodePort` has been renamed `service.nodePorts.http`.

  ### Upgrading to version 2.0.0

  Some parameters related to image management have been modified:

  - Registry prefix in `image.repository` parameters is now configured in `image.registry`.
  - Parameter `imagePullSecrets` has been renamed `global.imagePullSecrets`.
components:
  - name: kroki
    deployment:
      type: deployment
      container:
        livenessProbe:
          httpGet:
            path: /health
        readinessProbe:
          httpGet:
            path: /health
        startupProbe:
          httpGet:
            path: /health
        securityContext:
          readOnlyRootFilesystem: true
          runAsUser: 1001
          runAsGroup: 1001
        volumeMounts: |
          - name: empty-dir
            mountPath: /tmp
            subPath: kroki-tmp
          - name: empty-dir
            mountPath: /home/kroki
            subPath: kroki-home-kroki
      containers:
        - name: bpmn
          asComponent: true
          description: BPMN
          optional: true
          image:
            repository: yuzutech/kroki-bpmn
          ports:
            - name: http
              number: 8003
              description: HTTP
          securityContext:
            readOnlyRootFilesystem: true
            runAsUser: 1001
            runAsGroup: 1001
          volumeMounts: |
            - name: empty-dir
              mountPath: /tmp
              subPath: bpmn-tmp
            - name: empty-dir
              mountPath: /home/kroki
              subPath: bpmn-home-kroki
        - name: diagramsnet
          asComponent: true
          description: Diagrams.net
          optional: true
          image:
            repository: yuzutech/kroki-diagramsnet
          ports:
            - name: http
              number: 8005
              description: HTTP
          securityContext:
            readOnlyRootFilesystem: true
            runAsUser: 1001
            runAsGroup: 1001
          volumeMounts: |
            - name: empty-dir
              mountPath: /tmp
              subPath: diagramsnet-tmp
            - name: empty-dir
              mountPath: /home/kroki
              subPath: diagramsnet-home-kroki
        - name: excalidraw
          asComponent: true
          description: Excalidraw
          optional: true
          image:
            repository: yuzutech/kroki-excalidraw
          ports:
            - name: http
              number: 8004
              description: HTTP
          securityContext:
            readOnlyRootFilesystem: true
            runAsUser: 1001
            runAsGroup: 1001
          volumeMounts: |
            - name: empty-dir
              mountPath: /tmp
              subPath: excalidraw-tmp
            - name: empty-dir
              mountPath: /home/kroki
              subPath: excalidraw-home-kroki
        - name: mermaid
          asComponent: true
          description: Mermaid
          optional: true
          image:
            repository: yuzutech/kroki-mermaid
          ports:
            - name: http
              number: 8002
              description: HTTP
          securityContext:
            readOnlyRootFilesystem: true
            runAsUser: 1001
            runAsGroup: 1001
          volumeMounts: |
            - name: empty-dir
              mountPath: /tmp
              subPath: mermaid-tmp
            - name: empty-dir
              mountPath: /home/kroki
              subPath: mermaid-home-kroki
    emptyDir: true
    image:
      registry: docker.io
      repository: yuzutech/kroki
      tag: 0.28.0
    ingress:
      paths:
        - /
    service:
      ports:
        - name: http
          number: 8000
          description: HTTP
    hpa: true
tests: |
  import requests


  def test_service_connection():
      url = "http://{{ include "kroki.fullname" . }}:{{ .Values.service.ports.http }}/"

      response = requests.get(url)

      assert response.status_code == 200
