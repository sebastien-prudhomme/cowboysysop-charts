name: dolibarr
productName: Dolibarr
appVersion: 21.0.1
description: is <<a modern software package to manage your company or foundation's activity>>
home: https://www.dolibarr.org/
icon: https://raw.githubusercontent.com/Dolibarr/dolibarr/develop/doc/images/dolibarr_256x256_color.svg
license: 2022
source: https://github.com/Dolibarr/dolibarr
version: 8.0.0
updates: |
  ### Upgrading to version 8.0.0
  The chart now uses forked versions of the Bitnami charts to reference the Bitnami Legacy repository:

  - https://github.com/bitnami/containers/issues/83267

  A label `app.kubernetes.io/component` will be added to the Deployment. Run this command before upgrading to prevent an immutable field error:

  ```bash
  $ kubectl delete deployment/my-dolibarr-deployment
  ```

  Pod and container security contexts are now configured with default values.

  ### Upgrading to version 7.0.0

  The application has been updated to a major release, see the release notes for breaking changes:

  - https://github.com/Dolibarr/dolibarr/releases/tag/21.0.0

  The MariaDB subchart has been updated to a major release, see these upgrade instructions:

  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-2020
  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-2000
  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-1900

  ### Upgrading to version 6.0.0

  The application has been updated to a major release, see the release notes for breaking changes:

  - https://github.com/Dolibarr/dolibarr/releases/tag/20.0.0

  Information about services are no more injected into pod's environment variable.

  ### Upgrading to version 5.0.0

  The MariaDB subchart has been updated to a major release, see these upgrade instructions:

  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-1700
  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-1600
  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-1400
  - https://github.com/bitnami/charts/tree/master/bitnami/mariadb#to-1300

  ### Upgrading to version 4.0.0

  The chart is now tested with Kubernetes >= 1.24 and Helm >= 3.9.

  Future upgrades may introduce undetected breaking changes if you continue to use older versions.

  ### Upgrading to version 3.0.0

  Some parameters related to port management have been modified:

  - Parameter `service.port` has been renamed `service.ports.http`.
  - Parameter `service.nodePort` has been renamed `service.nodePorts.http`.

  ### Upgrading to version 2.0.0

  Some parameters related to image management have been modified:

  - Registry prefix in `image.repository` parameters is now configured in `image.registry`.
  - Parameter `imagePullSecrets` has been renamed `global.imagePullSecrets`.
components:
  - name: dolibarr
    deployment:
      type: deployment
      waitMariadb: true
      initContainer:
        command: |
          - /bin/bash
          - -ec
          - |
            rm -f /var/www/documents/install.lock
        securityContext:
          readOnlyRootFilesystem: false
          runAsUser: 0
          runAsGroup: 0
        volumeMounts: |
          - name: data
            mountPath: /var/www/documents
      container:
        env: |
          - name: DOLI_ADMIN_LOGIN
            value: {{ .Values.dolibarr.admin.username | quote }}
          - name: DOLI_ADMIN_PASSWORD
            valueFrom:
              secretKeyRef:
                name: {{ include "dolibarr.secretName" . }}
                key: {{ include "dolibarr.secretKeyAdminPassword" . }}
          {{- if .Values.dolibarr.cron.enabled }}
          - name: DOLI_CRON_KEY
            valueFrom:
              secretKeyRef:
                name: {{ include "dolibarr.secretName" . }}
                key: {{ include "dolibarr.secretKeyCronSecurityKey" . }}
          {{- end }}
          - name: DOLI_DB_HOST
            value: {{ include "dolibarr.mariadb.host" . | quote }}
          - name: DOLI_DB_HOST_PORT
            value: {{ include "dolibarr.mariadb.port" . | quote }}
          - name: DOLI_DB_USER
            value: {{ include "dolibarr.mariadb.username" . | quote }}
          - name: DOLI_DB_PASSWORD
            valueFrom:
              secretKeyRef:
                name: {{ include "dolibarr.mariadb.secretName" . }}
                key: {{ include "dolibarr.mariadb.secretKeyPassword" . }}
          - name: DOLI_DB_NAME
            value: {{ include "dolibarr.mariadb.database" . | quote }}
          - name: DOLI_URL_ROOT
            value: {{ .Values.dolibarr.externalUrl | quote }}
        livenessProbe:
          initialDelaySeconds: 180
          httpGet:
            path: /
        readinessProbe:
          httpGet:
            path: /
        securityContext:
          readOnlyRootFilesystem: false
          runAsUser: 0
          runAsGroup: 0
        startupProbe:
          httpGet:
            path: /
        volumeMounts: |
          - name: data
            mountPath: /var/www/documents
      containers:
        - name: cron
          optional: true
          env: |
            - name: DOLI_CRON
              value: "1"
            - name: DOLI_CRON_USER
              value: {{ .Values.dolibarr.cron.username | quote }}
            - name: DOLI_CRON_KEY
              valueFrom:
                secretKeyRef:
                  name: {{ include "dolibarr.secretName" . }}
                  key: {{ include "dolibarr.secretKeyCronSecurityKey" . }}
            - name: DOLI_DB_HOST
              value: {{ include "dolibarr.mariadb.host" . | quote }}
            - name: DOLI_DB_HOST_PORT
              value: {{ include "dolibarr.mariadb.port" . | quote }}
            - name: DOLI_DB_USER
              value: {{ include "dolibarr.mariadb.username" . | quote }}
            - name: DOLI_DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: {{ include "dolibarr.mariadb.secretName" . }}
                  key: {{ include "dolibarr.mariadb.secretKeyPassword" . }}
            - name: DOLI_DB_NAME
              value: {{ include "dolibarr.mariadb.database" . | quote }}
          volumeMounts: |
            - name: data
              mountPath: /var/www/documents
    image:
      registry: docker.io
      repository: dolibarr/dolibarr
      tag: 21.0.1
    ingress:
      paths:
        - /
    persistentvolumeclaim: true
    secret: |
      dolibarr-admin-password: {{ .Values.dolibarr.admin.password | b64enc | quote }}
      {{- if .Values.dolibarr.cron.enabled }}
      dolibarr-cron-security-key: {{ .Values.dolibarr.cron.securityKey | b64enc | quote }}
      {{- end }}
    secretKeyHelpers: |
      {{/*
      Key in Secret that contains administrator password
      */}}
      {{- define "dolibarr.secretKeyAdminPassword" -}}
      {{- if .Values.existingSecret -}}
          {{ .Values.existingSecretKeyAdminPassword }}
      {{- else -}}
          dolibarr-admin-password
      {{- end -}}
      {{- end -}}

      {{/*
      Key in Secret that contains cron security key
      */}}
      {{- define "dolibarr.secretKeyCronSecurityKey" -}}
      {{- if .Values.existingSecret -}}
          {{ .Values.existingSecretKeyCronSecurityKey }}
      {{- else -}}
          dolibarr-cron-security-key
      {{- end -}}
      {{- end -}}
    secretKeyValues: |
      ## @param existingSecretKeyAdminPassword Key in existing Secret that contains administrator password
      existingSecretKeyAdminPassword: dolibarr-admin-password

      ## @param existingSecretKeyCronSecurityKey Key in existing Secret that contains cron security key
      existingSecretKeyCronSecurityKey: dolibarr-cron-security-key
    service:
      ports:
        - name: http
          number: 80
          numberForward: 8080
          description: HTTP
    extraValues: |
      dolibarr:
        admin:
          ## @param dolibarr.admin.username Administrator username
          username: admin

          ## @param dolibarr.admin.password Administrator password
          password: admin

        ## @param dolibarr.externalUrl External URL
        externalUrl: http://dolibarr.local

        cron:
          ## @param dolibarr.cron.enabled Enable cron for scheduled jobs
          enabled: false

          ## @param dolibarr.cron.username Cron username
          username: admin

          ## @param dolibarr.cron.securityKey Cron security key
          securityKey: ""
mariadb: true
tests: |
  import requests


  def test_service_connection():
      url = "http://{{ include "dolibarr.fullname" . }}:{{ .Values.service.ports.http }}/"

      response = requests.get(url)

      assert response.status_code == 200
